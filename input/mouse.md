# 鼠标事件

鼠标指针即鼠标操作事件，分移动事件和点击事件两种。在 RFB 协议中，使用 PointerEvent 表示客户端触发一次鼠标事件。

## 协议报文

鼠标事件的报文如下

```
  +--------------+--------------+--------------+
  | No. of bytes | Type [Value] | Description  |
  +--------------+--------------+--------------+
  | 1            | U8 [5]       | message-type |
  | 1            | U8           | button-mask  |
  | 2            | U16          | x-position   |
  | 2            | U16          | y-position   |
  +--------------+--------------+--------------+
```

- message-type: 无符号整形，固定 `0x5`
- button-mask: 8 位掩码，表示键位状态，`1`为按下，`0`为弹起
- x-position: 当前 X 坐标
- y-position: 当前 Y 坐标

button-mask 的 Bit0/1/2 位置分别代表鼠标的左键、中建、右键。使用滚轮的鼠标，每向上滑动一次，会发送一个 Bit3 的按下和弹起事件；每向下滑动一次，会发送一个 Bit4 的按下和弹起事件。

## USB/PS/2 鼠标协议

在 PS/2 或 USB 鼠标协议中，有类似 RFB 协议的表达方式。

```
 ┌──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┐
 │      │ Bit7 │ Bit6 │ Bit5 │ Bit4 │ Bit3 │ Bit2 │ Bit1 │ Bit0 │
 ├──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┤
 │Byte 1│Y Over│X Over│X Sign│Y Sign│ 0x1  │ Mid  │Right │ Left │
 ├──────┼──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┤
 │Byte 2│                      X Movement                       │
 ├──────┼───────────────────────────────────────────────────────┤
 │Byte 3│                      Y Movement                       │
 ├──────┼───────────────────────────────────────────────────────┤
 │Byte 4│                      Z Movement                       │
 └──────┴───────────────────────────────────────────────────────┘
```

鼠标协议和 RFB 协议有两点不同：

- 鼠标协议的 Bit0/1/2 和 RFB 协议的 Bit0/2/1 对应
- 鼠标协议的中轮转动，需要转换为 RFB 协议的按下/弹起事件

> 根据 [wiki](https://en.wikipedia.org/wiki/RFB_protocol#Limitations) 描述，RFB 协议只支持8个鼠标键位，左中右和滑轮占用5个，只有3个键位给特殊按键（例如：多功能游戏鼠标）